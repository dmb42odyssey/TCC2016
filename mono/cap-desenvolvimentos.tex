%% ------------------------------------------------------------------------- %%

\chapter{Conceitos Teóricos} \label{CONCEITOS}
\section{Poluição Atmosférica} \label {POLUICAO_ATMOSFERICA}
\label{cap:desenvolvimento}
\subsection{História e evolução}
\par Antes da Revolução Industrial, a poluição atmosférica era limitada a queima de madeira e a pequena atividade de artesanato e, portanto nunca houve um estudo acerca de seus impactos devido a baixa e localizada quantidade emitida. Entretanto, o advento da Revolução Industrial trouxe além da introdução de máquinas e novos processos na manufatura, a popularização do uso de carvão como combustível. Esse uso comum e em larga escala pelas indústrias deu origem aos primeiros problemas de poluição no ambiente externo, com o surgimento de nevoeiros nas cidades altamente industrializadas. Atualmente, com a formação de grandes centros urbanos e o número cada vez maior de veículos automotores nessas regiões, a atividade industrial deixou de ser o principal fator de impacto na qualidade do ar, como ilustra a figura \ref{fig:sp}. Tendo em vista que o estudo e monitoramento dos poluentes atmosféricos tornaram-se fundamentais para o controle das emissões dos contaminantes, descreve-se abaixo os poluentes que normalmente são medidos pelas estações de monitoramento do mundo e da cidade de São Paulo.

\begin{figure} [H]
\centering
\includegraphics[scale=0.5]{sp}
\caption{\label{fig:sp} Poluição do ar na cidade de São Paulo. Fonte: \href{http://www.freeimages.com/photo/pollution-in-the-city-1445561}{freeimages}}
\end{figure} 

\subsection{Poluentes} \label{POL}
\par Os poluentes são classificados de acordo com a sua origem. Aqueles que são gerados diretamente da fonte, como acontece na combustão incompleta de combustíveis fósseis em veículos automotores, são chamados de poluentes primários. Por outro lado, se a produção é realizada através de uma série de reações químicas na atmosfera, então classifica-se como poluente secundário. É possível que o mesmo poluente receba ambas classificações.
\subsubsection{Monóxido de Carbono}
\par O monóxido de carbono ($CO$) é um poluente primário formado a partir da queima incompleta de combustíveis a base de carbono liberados em queimadas feitas pelo homem ou por motores a combustão. A redução de oxigenação nos tecidos é um efeito bem conhecido e notório do $CO$, e alguns de seus sintomas incluem dor de cabeça, náuseas, tontura, febre, vômitos e sensação de fraqueza. Apesar de ser considerado letal em ambientes fechados com alta concentração do gás, no ambiente externo é um poluente temporário e possui mais relevância como um dos reagentes para a formação de Ozônio.
\subsubsection{Dióxido de Enxofre}
\par As principais origens do dióxido de enxofre ($SO_2$ ) são a queima de combustíveis que contém sulfeto ou como subproduto da atividade industrial e, portanto classificando-se como um poluente primário. O combustível fóssil, principalmente o de carvão ou óleo, são os que possuem maior concentração de sulfeto. Esse composto químico, quando presente no combustível, irá liberar também $SO_2$ para atmosfera. O uso de carvão para aquecedores domésticos, geração de energia estacionária e veículos automotores são as fontes dominantes de emissão. A exposição a esse poluidor se dá pela inalação, e como o $SO_2$ é solúvel em meio aquoso, a absorção acontece nas mucosas do nariz e do trato respiratório superior. O exercício físico reduz essa absorção, porém permite a passagem do poluente para as pequenas vias aéreas. Uma exposição curta (de até no máximo 1 hora sem interrupção) implica em uma redução de índices de capacidade ventilatória dos pulmões e sintomas como chiado e falta de ar. Esses sintomas são amplificados em situação de realização de exercícios físicos ou com grupos sensíveis que possuem uma menor resistência.
\subsubsection{Dióxido de Nitrogênio}
\par O dióxido de nitrogênio ($NO_2$) tem origem principalmente na queima de combustíveis fósseis na combustão interna dos motores, liberando então o poluente primário pelo escapamento do veículo quando o mesmo não possui um funcionamento adequado do catalisador. Como no ambiente se apresenta na forma de gás, a exposição humana ao poluente também se dá pela inalação. O contaminante pode ser absorvido pelo trato respiratório, e a maior exposição se dá na região de troca de gases nos pulmões. Sabe-se, em experiências com outros animais, que há efeitos no metabolismo, estrutura, função e inflamação dos pulmões. Entretanto, devido à falta de informação sobre o tipo de exposição ou dosagem inalada que poderiam causar tais mudanças em humanos, é difícil deduzir se é tóxico ou não quando o gás se encontra disperso no ambiente. O $NO_2$ é outro poluidor temporário e também o mais importante para a formação do Ozônio, por ter um tempo de vida menor e ser produzido em maior quantidade que o $CO$. 
\subsubsection{Ozônio}
\par O Ozônio($O_3$) é formado através de uma série de reações químicas complexas quando uma mistura de Oxigênio($O_2$) e $NO_2$ ou $CO$ é exposta a luz solar. Diferente dos poluidores descritos anteriormente, onde a origem se dá na fonte (poluente primário), a formação do $O_3$ se dá na atmosfera, recebe a classificação de poluente secundário. A concentração do gás sofre uma variação espacial considerável, já que pode ser transportado para outras áreas com a presença de ventos. Desse modo, pode existir uma concentração maior nos arredores da cidade, em subúrbios, ou até mesmo em áreas mais arborizadas e que não possuem uma grande concentração de veículos. Essa locomoção do gás é a explicação mais plausível para que o Campus da Universidade de São Paulo tenha sido considerado a região mais poluída pelo segundo ano consecutivo~\cite{FOLHA2016}. A combinação de megacidades com emissões significativas de precursores do Ozônio, somado ao clima que favorece as reações fotoquímicas potencializam ainda mais a formação do gás. Os efeitos nos seres humanos, quando em alta concentração, têm relevância em respostas agudas, como a inflamação e redução da defesa pulmonar, a morbidez e a mortalidade principalmente para idosos.
\subsubsection{Material Particulado}
\par O Material Particulado ($PM$) pode ser encontrado na forma de partículas sólidas, ou suspenas em gotículas no ar ou uma mistura dos dois, e é considerado tanto um poluente primário como secundário. Sua geração natural provém da atividade de vulcões, tempestades de areia e queimada. Já a queima de combustíveis fósseis, principalmente no uso do Diesel, e a atividade industrial são as principais fontes pela atividade humana. Além disso, o poluente recebe uma outra subclassificação dependendo do tamanho do seu diâmetro aerodinâmico em micrômetros (\si{\micro\metre}). São classificadas como Material Particulado Grosso ($PM_{10}$) as partículas que possuem um diâmetro menor ou igual que $10\si{\micro\metre}$ e maior ou igual a $2,5\si{\micro\metre}$. Se esse diâmetro for menor que $2,5\si{\micro\metre}$, então passa para a classe de Material Particulado Fino($PM_{2.5}$). Como regra, quanto menor o tamanho do diâmetro para uma partícula, maior são os malefícios que essa pode causar devido a exposição. Dessa forma, as estações mantêm medições separadas tanto para $PM_{2.5}$ como para $PM_{10}$. Seja de qual subclasse, os sintomas causados são os mais variados: induzir inflamação pulmonar, redução da função pulmonar, disfunção do sistema vascular e pulmonar, aumento do risco de câncer e artrite reumatóide, aumento da pressão arterial em descanso, redução da variabilidade da frequência cardíaca além de contribuir com o aumento da mortalidade e morbidade. 
\subsection{Índice de qualidade do ar}
\par Diante dos vários poluentes e seus diferentes níveis de concentrações que o tornam tóxico, criou-se a necessidade de descobrir uma maneira simples de classificar a qualidade do ar. Para isso, foi criado o índice de qualidade do ar, que é um valor inteiro adimensional obtido ao mapear a medida de concentração do poluente. Uma vez calculado o índice, é possível avaliar a qualidade do ar e atribuir uma cor. 
%% NOVO %%
\par Apesar do uso comum de técnicas de interpolação para o cálculo do índice de qualidade do ar, os três diferentes modelos diferem na escala para o mapeamento desse índice. O primeiro, baseia-se no sistema criado pelos Estados Unidos, onde as concentrações de cada poluente são transformados em uma escala numérica normalizada de 0 a 500. Em alguns países, como na Austrália, o segundo modelo troca a escala normalizada utilizada pelo sistema americano por uma escala linear ou proporcional, a fim de levar em conta a variação de concentração. Por último, o modelo europeu faz uso de uma escala de 1 a 10, onde cada número representa uma faixa de cor com a sua a qualidade do ar. Este modelo é utilizado pelo Reino Unido, por exemplo. Usada como referência no aplicativo, a tabela \ref{tab:INDICE} mostra para cada qualidade do ar, os valores de índice possíveis na forma de um intervalo, e a cor associada.
\begin{table} [H]
\centering
\caption{Índices e cor definidos para cada qualidade do ar.}
\label{tab:INDICE}
\begin{tabular}{cccc}
\hline
Qualidade      & Índice   & Cor           \\ \hline
Boa           & [0,40]        & Verde                           \\
Mediana & [41,80]       & Amarelo                  \\
Ruim  & [81,120]       & Laranja              \\
Muito Ruim    & [121,200] & Vermelho                    \\
Péssima       & [200, infinito]       & Roxo                       \\ \hline
\end{tabular}
\end{table}
\par Como os índices são extraídos diretamente (mais detalhes na seção \ref{SG}) e a classificação da qualidade do ar segue os mesmos critérios da Companhia de Tecnologia e Saneamento Ambiental  (CETESB)\footnote{Detalhes no site \url{http://ar.cetesb.sp.gov.br/padroes-de-qualidade-do-ar/}}, que baseia-se no modelo americano, não há a necessidade de fazer ou modificar esse mapeamento dentro do aplicativo e, portanto, otimizando o processamento das informações.
\subsection{A preocupação com o $PM$ e $O_3$} \label{GRUPOSAUDE}
\par De todos os poluentes, o Particulado e o $O_3$ são os que recebem mais atenção dentro das organizações de saúde. Apesar do ozônio não apresentar tantos malefícios, esse poluente merece destaque por sua alta produção na atmosfera, principalmente no verão. Por outro lado, o Particulado, especialmente o $PM_{2.5}$, merece atenção devido tanto aos efeitos agudos (imediato) e crônicos (dosagens ao longo do tempo). Essa preocupação com os dois poluentes se justifica ainda mais em grupos sensíveis da população que são definidos pelo estado de saúde ou por características específicas, formado por crianças em fase de desenvolvimento, mulheres no período gestativo, doenças pré-existentes em indivíduos e adultos com idade avançada. Assim, os indivíduos que se encontram nesses grupos são mais propensos a sentir efeitos danosos a saúde diante da exposição aos poluentes. Os atletas representam outro grupo em que a exposição é maior durante o exercício físico, em virtude da alta ventilação do organismo. Entre os dois poluentes, o Particulado representa o maior risco para os atletas, já que não é incomum a prática de exercícios próxima a vias com alto tráfego. Desse modo, a prática de exercícios em ambientes poluídos deve ser evitada para preservar o desempenho e a saúde do atleta.
\subsection{Obtenção de dados}
\par Mesmo com o estudo científico dos malefícios que esses contaminantes relacionado à poluição atmosférica possam causar, um outro desafio é a obtenção das concentrações dos poluentes. Necessita-se de muitas estações bem distribuídas dentro da região desejada para se obter uma boa cobertura de monitoração. No Brasil, entretanto, muitas regiões do país ainda carecem de sistemas para tal monitoramento. Segundo o relatório de 2014 do Instituto de Saúde e Sustentabilidade sobre o monitoramento da qualidade do ar, apenas as regiões mais populosas no centro-sul do país possuem um sistema de medição por parte do órgão ambiental do estado~\cite{ISS2014}. 
\par Na cidade de São Paulo, a CETESB desenvolveu o sistema QUALAR ~\cite{QUA}, e instalou estações tanto na região metropolitana como em outras cidades do estado. Apesar de ser comum ter esse tipo de monitoramento por parte de um departamento do estado, é possível que uma iniciativa livre ou empresa venha fazer suas próprias medições, como é o caso do grupo Código Urbano. Essa frente, utilizando um sensor mais barato, como mostra a figura \ref{SENSORODM}, mede a qualidade do ar com melhor precisão em tempo real e manda as informações para a internet, que podem ser acessadas no site OpenDustMap (\cite{ODM}). Uma grande vantagem é que a instalação desses sensores pode ser feita por pessoas comuns que estejam interessadas em medir a qualidade do ar em seus bairros.

\begin{figure} [H]
\centering
\includegraphics[scale=0.5]{odm}
\caption{\label{SENSORODM} Sensor utilizado pelo grupo CódigoUrbano. Autor: Ana Elisa Santana, Fonte:  \href{http://codigourbano.org/sensor-feito-com-tecnologia-livre-pretende-medir-poluicao-do-ar-em-regioes-criticas/}{CódigoUrbano}}
\end{figure} 

\par O número de estudos e pesquisas a respeito do impacto ou concentração da poluição do ar de São Paulo são vastos, mas apenas o QUALAR e o ODM dispõem dos recursos necessários para fazerem as medições de hora em hora sobre a qualidade do ar. Como não existe nenhum interesse por parte do governo para o uso de sistemas mais sofisticados feitos pelas grandes empresas de tecnologia, o QUALAR e o ODM são os únicos sistemas capazes de obter informações dos poluentes do ambiente em São Paulo. Devido à quantidade maior de estações de monitoramento e por estarem mais bem distribuídas na cidade de São Paulo, e mesmo com algumas áreas carentes de acompanhamento usa-se o sistema QUALAR para a obtenção de dados nesse trabalho. A tabela \ref{ESTACOES} mostra para cada estação da região do Alto Tietê, os poluentes medidos.

\begin{table} [H]
\centering
\caption{Poluentes medidos por estação}
\label{ESTACOES}
\begin{tabular}{ccccccc}
\hline
Estação & PM2,5 & PM10 & O3 & SO2 & NO2  & CO \\ \hline
Carapicuíba &   & X & X & & X & X  \\
Diadema &   & X & X & &  &   \\
Guarulhos - Paço Municipal &   & X & X & &  X & \\
Guarulhos - Pimenta & X & X & X & X & X & X \\
Mauá* &  &  &  &  & &  \\
Osasco &  & X &  & X & X & X  \\
Santo André - Capuava &  & X &  X & X &  &  \\
Santo André - Centro &   & X &  & &   & X  \\
São Bernardo - Pauliceia &   & X &  & &  &   \\
São Bernardo - Centro & X &  & X &  & X & X \\
Capão Redondo &  & X & X &  & X &  \\
São Caetano do Sul & X & X & X &  & X & X \\
Congonhas  & X  & X &  & &   &   \\
Ibirapuera & X &  & X & & X & X \\
USP - Ipen & X &  & X &  & X &  \\
Interlagos  & & X & X & X & X & \\
Itaim Paulista  & & X & X &  &  & \\
Itaquera & &  & X  &  &  & \\
Mariginal Tietê & X & X &  & X & X & X \\
Mooca &  & X & X &  &  & X \\
Parelheiros & X & X & X &  & X & X \\
Parque Dom Pedro II &  & X & X & X & X & X \\
Pinheiros &  &  & X & &  X & X \\
Santana &  & X & X & & & \\
Santo Amaro &   & X & X & &   & X  \\ \hline
\end{tabular}
\end{table}
\newpage
%% ------------------------------------------------------------- %%
\section{Geodésia} \label{GEODESIA}
%% TO DO: POR QUE ESSES CONCEITOS SÂO IMPORTANTES? (PARAGRAFO PARA EXPLICAR)
\par Naturalmente, dado o objetivo do aplicativo, a obtenção da localização do usuário e os cálculos das distâncias entre ele e as estações na superfície terrestre, apresentam-se como um problema. A solução foi usar conceitos básicos e fundamentais das ciências geodésicas, pois é possível representá-los na implementação de funcionalidades no aplicativo. A Geodésia, uma ramificação da matemática aplicada e geociência, é a ciência dedicada a medição e representação de planetas, incluindo a Terra. 
\par Por conta das características geográficas do planeta Terra, necessita-se da utilização de outros sistemas de coordenadas para a distância e a localização de pontos. Em relação a geometria geodésica, existem dois tipos de problemas dentro dessa área científica: o problema direto e indireto. No primeiro, dado um ponto com suas coordenadas, a direção do Azimute (ângulo medido no plano horizontal entre o meridiano do lugar do observador e o plano vertical que contém o ponto observado) do primeiro, e a distância até o segundo ponto, determinam-se as coordenadas do segundo ponto. Já no caso indireto, dado as coordenadas dos dois pontos, normalmente calcula-se o Azimute dos dois pontos e a distância em linha reta entre eles. Como o interesse está na obtenção do valor da distância, a apresentação e explicação dos conceitos abaixo é direcionado ao problema indireto. A solução desse problema, isto é, encontrar o valor da distância entre os dois pontos, será usado para o método particular no próximo capítulo.  
\subsection{Latitude e Longitude} \label{LATLONG}
\par A partir do uso das duas coordenadas Latitude e Longitude, é possível descrever qualquer posição na superfície do planeta. A Latitude, representada pela letra grega $\phi$, é a distância, em graus, do ponto desejado em relação à Linha do Equador. Por definição, a linha se encontra no $ 0^{\circ}$, pois separa os hemisférios norte e sul. O valor da distância acima da linha é positivo e vai até $ 90^{\circ}$ e abaixo da linha é negativo e vai até $ -90^{\circ}$. Por outro lado, a Longitude, representada pela letra grega $\gamma$, é a distância, em graus, do ponto desejado em relação ao Meridiano de Greenwich. Essa linha vertical imaginária é a separação entre os hemisférios ocidental e oriental, e também se encontra $ 0^{\circ}$. Assim, a leste do meridiano se encontram os valores positivos, chegando ao máximo a $ 180^{\circ}$, e a oeste se encontram as distâncias negativas chegando a no mínimo $ -180^{\circ}$. Observa-se que é utilizado para as coordenadas geográficas o sistema de notação de graus, minutos e segundos ao invés do ângulo decimal por convenção. 
\subsection{Sistema de Posicionamento Global}
\par O Sistema de Posicionamento Global, mais conhecido como GPS (do inglês \textit{Global Positioning System}), foi criado em 1995 pelo Departamento de Defesa Americano, originalmente para fins militares. Ativo desde então, o sistema é o mais popular para encontrar a posição de um indivíduo no planeta, fazendo uso de informações coletadas por satélites de comunicação que orbitam a Terra. Essas informações são transmitidas por sinal de rádio para um receptor no planeta, e então a partir do cruzamento das localizações obtidas de vários satélites, é possível determinar a posição de uma pessoa no planeta com altíssima precisão, como ilustra a figura \ref{fig:GPS}. Portanto, serviços que fazem uso do GPS possuem dados como as coordenadas geográficas, descritas anteriormente na seção \ref{LATLONG}, e o endereço do local do usuário. Estimam-se que para fazer a cobertura do planeta, existem aproximadamente 2 mil satélites em operação na órbita da Terra ~\cite{EB2015}. 
\begin{figure} [H]
\centering
\includegraphics{GPS}
\caption{\label{fig:GPS} Funcionamento do GPS. Os satélites usados para a determinação da localização são os pontos vermelhos, e as informações deles são usadas para determinar o resultado final.}
\end{figure} 
\subsection{Circulo Máximo}
\par Antes de entrar em detalhes nos métodos abaixo, necessita-se descrever alguns conceitos que são utilizados para o cálculo da distância. O mais importante, que recebe o nome de Circulo Máximo ou Grande Círculo, é a intersecção entre uma esfera e de um plano passando no centro da mesma. Como o diâmetro do circulo máximo coincide com o diâmetro da esfera, todos os círculos máximos possuem a mesma circunferência e o mesmo centro da esfera. Dessa forma, dois pontos dentro do Circulo Máximo dividem o comprimento de sua circunferência em dois arcos, como mostra a figura~\ref{fig:gc}. Assim, o menor arco é chamado de ortodromia ou distância do círculo máximo e representa a menor distância entre dois pontos em linha reta na superfície de uma esfera. Existe em geral apenas um único Circulo Máximo para cada 2 pontos, com exceção no caso em que os pontos são chamados  de antipodais, que são diametralmente opostos, e, portanto o comprimento dos arcos são iguais. Nessa situação, encontram-se infinitos grandes círculos, onde um exemplo seria a distância entre polo norte e sul da Terra.
\begin{figure} [H]
\centering
\includegraphics{grandecirculo}
\caption{\label{fig:gc} O menor arco (em vermelho), obtido ao determinar o círculo máximo entre P e Q, representa a menor distância entre esses pontos na esfera.}
\end{figure} 
\subsection{Fórmula de Haversine } \label{HAVERSINE}
\subsubsection{ Lei de Haversines}
\par Foi descoberto em 1805 uma das fórmulas mais importantes dentro da navegação, que fornecia o valor das ortodromias baseado na Latitude e Longitude dos pontos fornecidos, chamada de Fórmula de Haversine. Considerando que a Terra é uma esfera, a fórmula é obtida através de um caso especial, descrito em mais detalhes abaixo, da lei dos haversines, que relaciona lados e ângulos em triângulos esféricos como mostra a figura~\ref{fig:triangulosesfericos}.
\begin{figure} [H]
\centering
\includegraphics{haversineleicos}
\caption{\label{fig:triangulosesfericos} Ilustração da Lei dos haversines na esfera unitária.}
\end{figure} 
\par Seja uma esfera unitária, isto é, o conjunto de pontos $(x_1,x_2,x_3)$ que satisfaz $ {x_1}^2 +{x_2}^2 +{x_3}^2 = 1$, e um triângulo esférico cujos vértices são $u$, $v$ e $w$. Se $a$ é a distância de $u$ a $v$, $b$ de $u$ a $w$ e $c$ de $v$ a $w$, e o ângulo oposto a $c$, $C$, então a lei dos haversines diz que:
\begin{center}
\begin{equation} \label{eq:1}
hav(c) = hav(a -b) + \sin(a)\sin(b)hav(C)
\end{equation}
\end{center}
onde $hav$ representa a função Haversine, dada por: $ hav(\theta) = {\sin^2(\frac{\theta}{2})}$

\subsubsection{Fórmula}
\par A partir da enunciação da lei de haversines, agora é possível obter a Fórmula de Haversines. Considere o caso particular em que $u$ está localizado no polo norte. Seja $d$ a distância a ser obtida, que separa $v$ e $w$. Nesse caso, $a = \frac{\pi}{2} - \phi_1$ e $ b = \frac{\pi}{2} - \phi_2$, C é separação de longitude $\gamma_2 - \gamma_1$  e $ c = \frac{d}{R}$, onde $ R $ é o raio da esfera. Então, substituindo na eq(\ref{eq:1}):

\begin{center}
\begin{equation} 
hav(\frac{d}{R}) = hav({\phi_2} - {\phi_1}) + \sin(\frac{\pi}{2} - \phi_1)\sin(\frac{\phi}{2} - \phi_2)hav(\gamma_2 - \gamma_1)
\end{equation}
\end{center}
Fazendo uso das relações trigonométricas ($\sin(a - b) = \sin(a)\cos(b) - \sin(b)\cos(a)$):
\begin{center}
\begin{equation} 
\sin(\frac{\pi}{2} - \phi_t) =sin(\frac{\pi}{2} )\cos(\phi_t) - \sin(\phi_t)\cos(\frac{\pi}{2} ) =\cos(\phi_t)
\end{equation}
\end{center}
Portanto:
\begin{center}
\begin{equation} \label{eq:2}
hav(\frac{d}{R}) = hav({\phi_2} - {\phi_1}) + \cos(\phi_1)\cos(\phi_2)hav(\gamma_2 - \gamma_1)
\end{equation}
\end{center}
\par A eq(\ref{eq:2}) obtida é a famosa Fórmula de Haversine. Entretanto, a fórmula do modo que está não fornece diretamente a distância $d$, e, portanto, apresenta-se  apenas como uma relação de igualdade. Para poder obter o valor de $d$ é necessário que se utilize a função Haversine na equação eq(\ref{eq:2}):
\begin{center}
\begin{equation} 
{\sin^2(\frac{d}{2R})} = \sin^2(\frac{\phi_2 - \phi_1}{2}) + \cos(\phi_1)\cos(\phi_2)\sin^2(\frac{\gamma_2 - \gamma_1}{2})
\end{equation}
\end{center}
\begin{center}
\begin{equation} 
{\sin(\frac{d}{2R})} = \sqrt{\sin^2(\frac{\phi_2 - \phi_1}{2}) + \cos(\phi_1)\cos(\phi_2)\sin^2(\frac{\gamma_2 - \gamma_1}{2})}
\end{equation}
\end{center}
\begin{center}
\begin{equation} 
\frac{d}{2R} = \arcsin(\sqrt{\sin^2(\frac{\phi_2 - \phi_1}{2}) + \cos(\phi_1)\cos(\phi_2)\sin^2(\frac{\gamma_2 - \gamma_1}{2})})
\end{equation}
\end{center}
Finalmente:
\begin{center}
\begin{equation} \label{eq:3}
{d} = 2R\arcsin(\sqrt{\sin^2(\frac{\phi_2 - \phi_1}{2}) + \cos(\phi_1)\cos(\phi_2)\sin^2(\frac{\gamma_2 - \gamma_1}{2})})
\end{equation}
\end{center}
\par A equação (\ref{eq:3}) obtida permite o calculo de $d$ diretamente, ou seja, a distância entre $v$ e $w$. Observa-se que os valores de $\gamma_1$, $\gamma_2$, $\phi_1$ e $\phi_2$ se apresentam em graus decimais, e devem ser convertidos preferencialmente para radianos. Além disso, deve-se escolher cuidadosamente o tamanho de R, pois como foi descrito acima, o raio da Terra pode sofrer uma variação de aproximadamente 22km, ou seja, entre 6356.752 km nos polos e 6378.137 na linha do Equador. O valor mais comum aceito e usado é $R = 6371km$.
\par Na situação em que os dois pontos são próximos, a fórmula de Haversine não possui problemas de arredondamento devido ao uso dos senos para o cálculo. Ademais, a equação é bem condicionada, isto é, uma pequena perturbação nos valores de Latitude e Longitude implica em um pequeno erro proporcional no valor final da distância. Outro benefício da fórmula é o balanço entre precisão e velocidade para o processamento, ao contário de outras alternativas que priorizam precisão mas apresentam velocidade menor porque calculam o resultado através de métodos iterativos e não diretamente. Entretanto, na situação em que os pontos são antipodais (polo norte e polo sul, por exemplo), erros numéricos relativos são grandes. Isso acontece porque o termo dentro da raiz da equação (\ref{eq:3}) se aproxima do valor 1, e, portanto não é aconselhado usar a fórmula nessa situação. Além disso, pelo fato de supor que a Terra é uma esfera, somado as diferenças no seu raio de curvatura, a fórmula de Haversine pode acumular um erro de até 0.5\% de sua medida.
\section{Análise Numérica} \label{ANALISE}
\subsection{Inverso da Potência das Distâncias} \label{IDW}
\par  O método do Inverso da Potência das Distâncias (IDW, abreviado do inglês \textit{Inverse Distance Weighting}) calcula o valor de certa propriedade (ou fenômeno) de um novo local desejado. Esse procedimento de interpolação determinístico, a partir de um conjunto de dados onde cada dado possui o valor de certa propriedade e o valor da distância em relação ao lugar desejado, calcula-se através de uma média ponderada o valor do fenômeno nesse novo local. Uma definição formal desse fenômeno é dada por:\newline

\begin{center}$u(x): x \rightarrow \mathbb{R}$, $ x \in \mathbb{R}^n \subset D$\end{center}

\noindent onde: $D$ é a região de estudo. (No caso de $n = 2$, um plano, por exemplo) 
\par
\par Observe que para geometria esférica, mencionanda na seção \ref{LATLONG}, $x \in  \mathbb{R}^2$, pois $x = (\phi,\lambda)$. Seja um conjunto finito de pontos conhecidos no espaço, $[(x_1,u(x_1)),(x_2,u(x_2),...,(x_n,u(x_n)]$ em D. Obtêm-se o valor do fenômeno  $u(x_{n+1})$ desconhecido de um ponto desejado $x_{n+1}$ com a utilização de uma média ponderada ($w_i(x)$) dos fenômenos $u(x_i)$ dados pelo inverso das suas respectivas distâncias ao quadrado. Sua fórmula é dada por:

\begin{center}$u(x) = \frac{{\sum\limits_{i = 1} ^{n}  w_i(x)u_i}}{\sum\limits_{i = 1}^{n} w_i(x)}$\end{center}
onde:

\begin{center}$w_i(x) = \frac{1}{d(x,x_i)^p}$\end{center}

\noindent $d(x,x_i)$: Distância entre $x$ e $x_i$. \newline \noindent
$p$:  Parâmetro da potência. 

\par O método acima faz a suposição de que pontos que estão mais próximos da localização a ser calculada contribui mais para o valor final obtido, como ilustra a figura \ref{fig:sem1}, porém não se leva em consideração a estrutura espacial. Conforme a distância vai aumentando, a relevância das medidas dos pontos mais afastados para o valor final diminuem. Desse modo, o parâmetro real $p$ simboliza a que taxa ocorre essa diminuição, servindo também como controle do tamanho da vizinhança. Portanto, o crescimento de $p$ significa a exclusão ou menor relevância de pontos mais afastados, enquanto que se utilizarmos o menor valor, que é $p = 1$, o peso é apenas o inverso da distância medida, permitindo assim a inclusão de pontos mais afastados no cálculo do valor desconhecido. Tipicamente, usa-se $p = 2$, e nessa forma, o modelo se chama inverso do quadrado das distâncias. \par Apesar do erro cometido pelo modelo geral estar diretamente relacionado com o valor $p$ e ao conjunto de dados, o inverso do quadrado das distâncias é uma boa solução quando é desejado que as medidas mais próximas do ponto a ser obtido tenham um peso maior no resultado final da medida calculada, perdendo pouca precisão se comparado a outros métodos ~\cite{AUS2008}.  
\begin{figure} [H]
\centering
\includegraphics{sem1}
\caption{\label{fig:sem1} Ilustração do IDW no plano. Pontos A e B tem maior influência no resultado de u(x) do ponto vermelho do que os pontos E e D.}
\end{figure} 
\par	Finalmente, o cálculo da distância $d(x,x_i)$ depende do contexto da região de estudo e do valor da dimensão espacial. No caso das coordenadas geográficas, que são utilizadas nesse trabalho, o cálculo dessa distância deve ser feito de acordo com a técnica apresentada na seção \ref{HAVERSINE}.
\section{Protocolo de Transferência de Arquivos} \label{FTP}
\par O Protocolo de Transferência de Arquivos (FTP, do inglês \textit{File Transfer Protocol}) é uma forma rápida de transferência de arquivos na Internet, permitindo receber ou enviar arquivos dado um endereço no navegador ou através de um software. O local no qual os arquivos ficam hospedados é chamado de servidor, enquanto as operações de transferência são realizadas por um computador cliente. O utilizador faz uma solicitação, fornecendo o nome ou endereço IP, assim como também o seu usuário e senha. Se todos os dados estiverem corretos, a conexão entre o cliente e servidor é criada, permitindo o acesso e transferência de arquivos. Tanto o aplicativo como o \textit{script} gerador de dados, que serão apresentados mais adiante, utilizam o FTP, mas com bibliotecas diferentes. O \textit{script} faz uso da implementação da biblioteca interna e nativa \textit{ftplib} para a realização da conexão, mas o aplicativo faz uso de bibliotecas externas. Outra diferença está no uso da biblioteca nas suas funções: o \textit{script} envia os dados ao servidor, enquanto o aplicativo faz \textit{download} dos mesmos.
%% novoJAN - REVER - %%
\par Como descrito no capítulo introdutório, um dos vários objetivos era o cálculo do índice no local do usuário, exibindo a qualidade de ar, o poluente responsável pela qualidade do ar (em figura), o local do usuário, e eventuais sugestões de prevenção. Para finalizar o capítulo, apresenta-se como os conceitos apresentados anteriormentente estão relacionados com o aplicativo e esse objetivo em particular. O método IDW apresentado na seção \ref{IDW} é utilizado para o cálculo do índice de qualidade, e consequentemente, a qualidade do ar e o seu poluente responsável, fazendo uso de definições básicas e fórmulas das ciências geodésicas na seção \ref{GEODESIA} para a representação de locais e na obtenção das distâncias na superfície da Terra. Além disso, o GPS, que também faz parte da Geodésia, é responsável por fornecer a localização do usuário. Finalmente, a explicação da origem e dos sintomas dos poluentes na seção \ref{POL} são usados para mostrar as possíveis recomendações de prevenção.
\par A obtenção e tratamento de dados, e a interação do usuário no aplicativo de forma fácil, que foram outros elementos citados nos objetivo, serão abordados nos próximos capítulos.  
    
%%
\chapter{Desenvolvimento do aplicativo} \label{DESENVOLVIMENTO}
\section{Android} \label{ANDROID}
\par Android é um sistema operacional (SO) desenvolvido pela empresa de tecnologia Google e projetado para dispositivos móveis (\textit{smartphones} e \textit{tablets}). Foi lançado em 28 de Setembro de 2008, e o sistema operacional é baseado no núcleo (\textit{kernel}, em inglês) do Linux e seu código fonte é lançado pela Google sob licença de código aberto. O seu baixo custo e a  alta capacidade de adaptação foram as principais razões para que as empresas fabricantes de dispositivos móveis adotassem o SO. Esse fato contribuiu tanto para a popularização do SO, que em 2015, a \textit{Nielsen Company} estimou que mais da metade dos americanos tivessem em seu \textit{smarthphone} o sistema Android~\cite{Nielsen2015}. Apesar de o núcleo ser escrito na linguagem de programação C, os aplicativos são escritos em Java, usando o kit de desenvolvimento do Android (SDK). A instalação de programas é feita através de um arquivo no formato \textit{APK}, ou através de um programa de loja de aplicativos virtual, como a \textit{Play Store}, que é a loja primária e pertencente a Google. 

\subsection{Interface de Programação de Aplicações}
\par Naturalmente, desde o lançamento do SO pelo Google, o Android passou por diversas atualizações. Essas atualizações refletem diretamente no valor inteiro e seu respectivo codinome, marcado como o \textit{level} da Interface de Programação de Aplicações, ou simplesmente API (abreviado do inglês \textit{Application Programming Interface}). A API é um importante \textit{framework} que fornece a comunicação com funcionalidades já construídas dentro do sistema ao programador. Além disso, o sistema foi projetado para que mesmo quando alguns recursos são trocados por funções novas, a API mantenha antigas implementações para não prejudicar os programas mais antigos. A tabela abaixo mostra a porcentagem dos dispositivos em relação aos codinomes da APIs, ordenados pela versão do sistema\footnote{Informações retirada do site \url{https://developer.android.com/}}:
\newpage
\begin{table}
\centering
\caption{Dados da distribuição dos dispositivos por codinome.}
\label{API}
\begin{tabular}{cccc}
\hline
Versão        & Api(s)   & Codinome           & Dispositivos (\%) \\ \hline
2.2           & 8        & Froyo              & 0,1               \\
2.3.3 a 2.3.7 & 10       & Gingerbread       & 1,5               \\
4.0.3 a 4.04  & 15       & Ice Cream Sandwich & 1,4               \\
4.1 a 4.3     & 16,17,18 & Jelly Bean         & 15,6              \\
4.4           & 19       & Kit Kat            & 27,7              \\
5.0 a 5.1     & 21,22    & Lollipop           & 35                \\
6.0           & 23       & Marshmallow        & 18,7              \\ \hline
\end{tabular}
\end{table}
\par Obviamente, a tabela \ref{API} mostra que menos de $20\%$ dos dispositivos utilizam versões do sistema mais atual, que são as APIs de codinome \textit{Marshmallow}. Desse modo, é evidente que antes de construir o aplicativo em si, é necessário estabelecer quais dispositivos ou a necessidade de uso de ferramentas mais complexas. Claramente, revela-se que o uso de recursos mais avançados significa um alcance menor no número de dispositivos que podem rodar um aplicativo. Assim, tendo em vista essas informações, o aplicativo construído nesse trabalho fará uso da API 16, pois se deseja que o programa possua uma alta cobertura de dispositivos, já que como foi explicado anteriormente, sistemas que possuem um valor maior do que 16 serão compatíveis com o programa. Portanto, significa que o programa executará nos sistemas androids com os codinomes: \textit{Jelly Bean},  \textit{Kit Kat},  \textit{Lollipop},  \textit{Marshmallow}, ou seja, poderá ser instalado em ao menos $96\%$ dos dispositivos com sistema Android. O motivo técnico de escolher a API 16 é por conta de uma maior facilidade e simplicidade para exibir as informações relevantes para interface do usuário, e por conta desse fato, o aplicativo certamente não será compatível com versões de codinome \textit{Gingerbread} ou anteriores.
\subsection{Java}
\par Java é uma linguagem orientada a objetos, e como dito anteriormente, usada para a escrita de aplicativos para o sistema Android. Dessa maneira, não basta especificar apenas a SDK utilizada, mas também o kit de desenvolvimento Java (JDK, abreviado do inglês \textit{Java Development Kit}). O aplicativo faz uso de uma biblioteca externa, chamada de \textit{Apache Commons Net 3.5}. Funcional apenas para as versões 1.6 ou mais do Java, essa biblioteca é chave para o download de informações atualizadas, por fazer uso do protocolo de transferências de arquivos (explicado em mais detalhes nas seções abaixo). A versão utilizada é a \textit{1.8}, mais especificamente, como \textit{1.8.0\_101}
\subsection{Android Studio}
\par Lançado em Dezembro de 2014 pelo Google, o Android Studio é o ambiente de desenvolvimento integrado (IDE) de multi plataforma oficial para o desenvolvimento de aplicativos e também utilizado para o desenvolvimento do aplicativo citado neste trabalho. O ambiente conta tanto com ferramentas avançadas de auto-completamento como de refatoração para a escrita do código em Java. A criação do \textit{layout} poderia ser trabalhoso e complicado, por serem gerados arquivos na forma de \textit{eXtensible Markup Language} (XML), mas a presença do editor gráfico do \textit{layout} torna a adição de elementos dinâmica e fácil. Além disso, diferente do plugin \textit{Android Development Tools} (ADT) feito para a IDE \textit{Eclipse} que usam o sistema de automação de compilação \textit{Apache Maven}, as dependências são carregadas com a utilização de uma ferramenta semelhante chamada \textit{Gradle}. Nesse sistema de automação de compilação, integrado ao Android Studio, apesar de usar os mesmos conceitos \textit{Apache Maven}, o arquivo de dependências não é um XML, mas sim em uma linguagem baseada em \textit{Apache Groovy}. A maior simplicidade na instalação e configuração, mais o fato do plugin ADT ter sido descontinuado para o uso no Eclipse desde Junho de 2015~\cite{ADT2015}, estão entre os principais motivos para o uso do Android Studio.
\section{\textit{Script} gerador} \label{SG}
\par Antes de ilustrar brevemente o funcionamento e interação do aplicativo, é importante descrever quais foram os mecanismos utilizados para geração do arquivo de dados. Apesar de não estar incluído no programa final em si, o \textit{script} faz a geração e formatação de dados, finalizando ao salvar o arquivo final em um servidor web. Dessa maneira, o aplicativo apenas importa direto do servidor um único arquivo que contém todos os dados. Essas informações se apresentam em várias páginas da web, ou seja, em um arquivo HTML por estação de monitoramento. Porém, para fazer o acesso a cada página, necessita-se não só preencher um formulário de login para ter acesso ao QUALAR, como também o preenchimento de informações para visualização por estação. Assim, a dificuldade resume-se em realizar de forma automatizada, navegar nas diferentes páginas, extraindo os índices dos respectivos poluentes e a marcação de dia e hora para cada estação. Em uma primeira tentativa, optou-se por implementar essa tarefa dentro do próprio aplicativo, porém a quantidade de bibliotecas externas, somado ao fato do tempo longo necessário para concluir as operações (em torno de 5 minutos) como ao razoável uso dos recursos do sistema, tornou a confecção praticamente inviável. Então, como descrito antes, a solução foi implementar um \textit{script} \textit{shell}, que executa dois módulos em Pyhton chamados de \textit{fetchData} e \textit{ftp}, em uma máquina Linux devidamente configurada para a realização dessa tarefa. Primeiramente, abordam-se as ferramentas ou bibliotecas externas e o seu papel, para depois descrever essas duas rotinas de forma geral. O \textit{script} gerador pode ser baixado do link: \url{https://github.com/dxhunter/monQASP2016/blob/master/executaveis/scriptgerador/scriptgerador.zip}.
\subsection{Selenium Web Driver} \label{SWD}
\par O Selenium Web Driver (\hspace{1sp}\cite{SELWEB}) é uma ferramenta originalmente desenvolvida para o auxílio de testes automatizados, mas que ficou conhecida também por ser uma ferramenta para a escrita de programas que realizam navegação automatizada. Suas bibliotecas permitem simular um navegador web de forma mais simples e eficiente, com suporte até mesmo de páginas que executam rotinas em javascript. Algumas de suas ações incluem: abrir uma janela, detetctar e apertar botões, detectar e preencher formulários, selecionar valores de um \textit{dropbox}, trocar de janela, detectar alertas e fechar o navegador e suas janelas restantes. Essa biblioteca, em um primeiro momento, auxilia o módulo \textit{fetchData} a acessar o site e realizar o login no sistema, acessando a \textit{Uniform Resource Locator} (URL) representado por ``Dados horários por estação'' em ``Consulta'' uma vez dentro do sistema. Depois, para cada estação, um \textit{pop-up} é gerado ao ter o botão ``Consultar'' clicado, onde a URL dessa janela é criada e contém as informações pertinentes. Obviamente, uma vez salva as informações do HTML da URL obtida, esse \textit{pop-up} é fechado, para repetir o processo e dar lugar a URL da próxima estação. Naturalmente, falhas podem ocorrer, e a detecção dos alertas é indispensável no tratamento desses erros: seja pular para próxima estação, ou tentar novamente do começo. 
\subsection{BeautifulSoup} \label {BS}
\par Em princípio, extrair os dados de um documento HTML pode parecer simples por se tratar de uma linguagem de marcação. Entretanto, o tamanho do documento, somado a quantidade de \textit{tags} de marcação dificulta a obtenção de dados que estão entre essas. Assim, uma primeira tentativa de extrair as informações, é a partir do uso de expressões regulares (abreviado em RegEx, no inglês), identificando os padrões de caracteres que contém a informação. Porém, uma expressão regular construída para marcações HMTL se torna longa e complicada demais rapidamente, tornando essa implementação complexa. A outra e utilizada alternativa, é o \textit{BeautifulSoup} (\hspace{1sp}\cite{BEA}), um \textit{parser} de HTML que permite de forma simples e flexível à obtenção do conteúdo dentro das \textit{tags} de marcação. No \textit{script}, a biblioteca é utilizada no arquivo HTML de cada estação para o fácil filtro da tabela de dados, extraindo o valor do índice de cada poluente. Não só o código é mais legível, como também é menor se comparado ao uso de expressões regulares.
\subsection{Pyhton}
Uma vez descrita as ferramentas utilizadas, finalmente é possível descrever o funcionamento em alto nível dos dois módulos. 
\subsubsection{fetchData} \label{FD}
\par Destaca-se nesse módulo a forma de armazenamento das estações válidas que são as estações apresentadas na tabela \ref{ESTACOES} na seção \ref{POLUICAO_ATMOSFERICA}. Utiliza-se um dicionário ordenado, onde a chave representa a palavra utilizada para o acesso de cada estação no aplicativo, e o elemento se trata do valor inteiro utilizado na \textit{checkbox} da estação no HTML de consulta. Em outras palavras, define-se para cada estação da RMSP, seu ``nome chave'' e respectivo valor de consulta, onde esse último é utilizado para acessar página da estação com os dados. Mais importante ainda, é manter a ordem na inserção a medida que cada par chave-valor é inserido, pois otimiza a performance do aplicativo quando está criando ou manipulando as estações a partir do arquivo final gerado por esse módulo. 
\par Uma vez definido esse conjunto chave-valor, o \textit{script} prossegue para a fase de navegação automática, utilizando a ferramenta \textit{Selenium Web Driver}, descrita na seção \ref{SWD}, com o objetivo de acessar a página com as medidas. Dentro da página, armazena-se o HTML na memória, para que o mesmo seja analisado pelo \textit{Beautiful Soup}, descrito na seção \ref{BS}. Completa a análise, como os índices da qualidade do ar se encontram em  \textit{tags} do tipo \textit{<th>...</th>}, seleciona-se todas as \textit{tags} com esse nome, e filtrando através da posição dos dados, a fim de obter as informações pertinentes da estação: os poluentes medidos e seus respectivos índices. Esse processo, começando desde a navegação automática, até a filtragem de informações, é realizado para cada estação, ou seja, para cada chave do conjunto chave-valor definido. Finalmente, observa-se que os dados são escritos em um arquivo temporário e depois são copiados para um arquivo definitivo porque o funcionamento do sistema pode ser interrompido para a atualização das páginas com as novas informações e, portanto, o arquivo de dados ficará incompleto e possivelmente fora da formatação esperada. Nesse caso, o aplicativo irá exibir informações inconsistentes, e por isso, é preferível não sobrescrever os dados da última atualização caso a leitura mais nova de dados falhe.
\subsubsection{ftp}
\par Desde que exista conexão com a internet, o segundo módulo chamado de ftp transfere o arquivo gerado pelo primeiro módulo para um servidor, pelo protocolo que foi descrito conceitualmente na seção \ref{FTP}. 
\subsection{X Virtual Framebuffer}
\par Apenas com as ferramentas apresentadas em \ref{SWD} e \ref{BS},  já é possível executar manualmente o \textit{script} gerador, descrito na seção \ref{SG}, que gera o arquivo de dados. Todavia, para tornar a execução do \textit{script} de forma automática e periódica, é necessário ainda fazer uso do chamado \textit{Xvfb} ou \textit{X Virtual Framebuffer}. Como o próprio nome em inglês sugere, o \textit{Xvfb} é um display virtual que segue os protocolos X11, que faz as operações gráficas na memória em uma janela comum criada, mas sem mostrar a tela diretamente para o usuário. O motivo pelo qual é necessário o \textit{Xvfb}, é por conta do agendador de tarefas \textit{Cron} (mais detalhes abaixo), que necessita de um display ao executar o \textit{script}. Uma vez fornecido o display virtual e a tarefa iniciada, todas as ações relacionadas ao navegador na subseção do Selenium Web Driver são realizadas, mas sem mostrar o navegador ao usuário. 
\subsection{Cron}
\par O \textit{Cron} é um programa que executa tarefas agendadas, e está presente nos sistemas \textit{Unix}. O agendamento de tarefas é feito por um programa, chamado de \textit{crontab}, editando o arquivo onde estão especificados os comandos a serem executados. Mostra-se abaixo a sintaxe que deve ser seguida para a execução de um comando:
\begin{lstlisting}
mm hh dd MM ss meuscript
\end{lstlisting}
mm = minuto (de 0 até 59) \newline
hh = hora(de 0 até 23) \newline
dd = dia(de 1 até 31) \newline
MM = mes(de 1 até 12) \newline
ss = dia da semana(de 0 até 6) \newline
\par Assim, especificando alguns dos valores acima e o \textit{script}, a execução acontece em um tempo periódico determinado no arquivo.
\chapter{Aplicativo QASP} \label{PRODUTOFINAL}
\par Concluído a descrição de como e quais ferramentas foram essenciais para o funcionamento, e também da explicação do módulo, agora é possível demonstrar a navegação e algumas configurações importantes do programa. O aplicativo, batizado de Qualidade de Ar de São Paulo, ou simplesmente abreviado para QASP, é o resultado final gerado por esse trabalho. O aplicativo pode ser baixado do link: \url{https://www.linux.ime.usp.br/~dmbuoro/mac0499/files/QASP.apk}.
\section{Navegação Principal}
\par A tela inicial, como mostra a figura \ref{fig:qaspscreen01}, é composta pela famosa \textit{Action bar}, que possui a cor de fundo verde, \textit{tabs} com diferentes funções (Lista Estações, Índice Local, Feedback), e por fim o conteúdo a ser exibido. A \textit{tab} sublinhada ``Lista Estações'' é iniciada por padrão, exibindo para cada estação as informações, que ainda necessitam serem definidas. A barra do \textit{menu}, aonde ficam informações como a porcentagem de carga da bateria e a hora atual, também é exibida com outra cor de fundo se a versão do sistema é pelo menos a \textit{Lollipop}. 
\begin{figure} [H]
\centering
\includegraphics{primeirascreenok}
\caption{\label{fig:qaspscreen01} Tela inicial ao abrir o QASP.}
\end{figure} 
\par A \textit{Action bar} do aplicativo possui dois ícones: uma seta para baixo e três pontos verticais, que representam a atualização de dados e um menu de preferências respectivamente (descrição mais abaixo). Ao apertar o ícone de seta para baixo, o QASP faz download dos dados mais atuais, fazendo uso do protocolo apresentado na seção \ref{FTP}, e atualizando as informações das estações. A figura \ref{fig:listaestacoesatualizado} mostra um exemplo do resultado dessa ação.
\par Para cada estação é mostrado seu nome, endereço, índice de qualidade do ar, e um quadrado com bordas arredondadas que representa o poluente responsável pelo índice, com a cor de fundo em sintonia com a qualidade do ar. Como para cada poluente há a possibilidade de cinco tipos de qualidade de ar, isso totaliza 30 figuras para atender cada caso esperado. Entretanto, a figura \ref{fig:listaestacoesatualizado} mostra também dois casos a mais: o ``?'' e ``OFF''. A imagem de ``?'' , como escrito anteriormente, é mostrada por padrão quando ainda não houve a atualização de dados, e também caso a estação, mesmo em funcionamento, não possua dados de poluente algum em sua página após a sincronia das informações. Por outro lado, o ``OFF''  se refere ao estado de funcionamento da página de exibição, que não está operando. Isso não implica que a estação em si não esteja operando, mas que a página usada para consulta no sistema QUALAR não está disponível.
\begin{figure} [H]
\centering
\includegraphics{listaestacoesatualizado}
\caption{\label{fig:listaestacoesatualizado} Exemplo do resultado ao pressionar o botão de seta para baixo, com as estações devidamente atualizadas.}
\end{figure} 
\par A atualização das estações mais a localização obtida pelo GPS permite o cálculo do índice local, que pode ser feito ao mover-se para a aba ``Ìndice Local''. Entretanto, dependendo do local, a obtenção das coordenadas pode levar algum tempo, e uma janela de erro é exibida caso essas ainda não tenham sido atualizadas. Caso contrário, calcula-se o índice de qualidade do ar no local do usuário, para cada poluente, pelo método apresentado na seção \ref{IDW}, utilizando $p = 2$, e mostrando o pior entre os 6 valores. O resultado é construído rapidamente, isso porque é usada uma matriz onde as linhas são as estações e as colunas os poluentes, e como consequência o acesso a essas informações são feitas de forma veloz, apesar do uso maior da memória do sistema. A figura \ref{fig:indicelocal}, mostra a exibição do resultado de forma parecida com a listagem de estações, mas incluindo o endereço do local dado pelo GPS, e possíveis recomendações para preservar a saúde do usuário. As sugestões de prevenção, baseadas nos sintomas dos poluentes abordados na seção \ref{POL}, são influenciadas por três parâmetros: a qualidade do ar, o poluente responsável e o perfil de usuário selecionado (explicado mais adiante na seção \ref{PREF}). Obviamente, recomendações mais drásticas são exibidas conforme a qualidade do ar diminui. Em casos onde há apenas um pequeno desequilíbrio, onde a qualidade do ar é registrada como ``mediana'', evitar a prática de exercícios intensos por um longo período de tempo ou a realização dos exercícios em ambientes fechados são algumas das possíveis recomendações. Em contrapartida, evitar qualquer tipo de exercício físico é a recomendação mais comum quando a qualidade do ar está ``péssima''.    %% NOVO %%
\begin{figure} [H]
\centering
\includegraphics{indicelocal}
\caption{\label{fig:indicelocal} Tela com a o resultado do índice da qualidade do ar no local do usuário. }
\end{figure} 
\par Finalmente, a útlima aba, nomeada de ``Feedback'', permite ao usuário avaliar as funcionalidades do aplicativo. Exige-se uma classificação (Ruim, OK, Bom) e um texto opcional para escrever os motivos, como mostra a figura \ref{fig:feedback}. Como o aplicativo necessita de constante atualização pelo usuário, é fundamental esse tipo de resposta na eventualidade de uma modificação no sistema de origem dos dados. O envio é feito através do cliente de e-mail de preferência do usuário. 
\begin{figure} [H]
\centering
\includegraphics{feedback}
\caption{\label{fig:feedback} Tela para o envio de \textit{feedbacks}}
\end{figure} 

\section{Preferências} \label{PREF}
\par Acessada através da figura dos três pontos verticais na \textit{Action Bar}, o usuário que entrar em ``Configurações'' poderá escolher opções que se encaixem melhor a sua experiência, como mostra a figura \ref{fig:preferencias}. A mais importante, ``Grupo'', modifica as recomendações de preservação de saúde se baseando no perfil de suas atividades ou no quadro de saúde do Usuário. Essa opção de personalização, como descrito na seção \ref{GRUPOSAUDE}, permite atender melhor inclusive usuários com perfis diferentes, e possui as opções: ``Normal'', ``Sensível'' e ``Esportista'', como mostra a figura \ref{fig:saudegrupo}. Um usuário que tenha selecionado ``Sensível'', por exemplo, poderá ver sugestões de preservação da saúde quando, dependendo do poluente, a qualidade do ar estiver ``Mediana'', o que não ocorreria para alguém que use o perfil ``Normal''.
\par Outra opção, a ``Região de Exibição'', possibilita apenas filtrar estações que são mostradas na aba ``Lista Estações''.  Essa opção é puramente estética, não interferindo no cálculo do índice local, isto é, as estações que não aparecerem na lista ainda são usadas para o resultado final. Assim, para não ficar tão grande a lista de exibição, o usuário pode remover estações fora da RMSP, ou ainda exibir somente as estações da cidade de São Paulo.
\begin{figure} [H]
\centering
\includegraphics{preferencias}
\caption{\label{fig:preferencias} Tela que mostra as opções existentes em ``Configurações''}
\end{figure}
\begin{figure} [H]
\centering
\includegraphics{saudegrupo}
\caption{\label{fig:saudegrupo} Seleção do grupo (pefil de saúde), note que é possível apenas uma escolha das três.}
\end{figure}